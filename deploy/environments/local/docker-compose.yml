version: '3.7'

services:
    reverse-proxy:
        image: nginx:alpine
        volumes:
            - ./nginx.conf:/etc/nginx/nginx.conf
        ports:
            - "80:80"
        container_name: authentication-local-proxy
        restart: always
        extra_hosts:
            - "host.docker.internal:host-gateway"

    back:
        container_name: authentication-local-back
        image: elyspio/authentication:back-local
        restart: always
        build:
            context: ../../../
            dockerfile: deploy/build/local.dockerfile
            args:
                folder: app/back
        ports:
            - "4001:4001"
        volumes:
            - "../../../app/back:/app"
            - /back/node_modules
        networks:
            cicd-network:
    
    front:
        image: elyspio/authentication:front-local
        container_name: authentication-local-front
        restart: always
        build:
            context: ../../../
            dockerfile: deploy/build/local.dockerfile
            args:
                folder: app/front
        ports:
            - "3001:3001"
        volumes:
            - "../../../app/front:/app"
            - /front/node_modules

networks:
    cicd-network:
        external: true
        name: cicd-network
